- if user_signed_in?
  %h3.enigma_signed_in_title.text-center
    enigma
  = link_to "Sign Out", destroy_user_session_path, id: "user_sign_out_link", method: 'delete'

  #map_area

- else
  %h2.enigma_title
    enigma
  .fb_login_button
    = link_to image_tag('login_with_fb.png'), user_omniauth_authorize_path(:facebook)




:javascript

  window.onload = function() {
    find_location();
  };

  var find_location = function() {
    var has_loaded = false;
    if (navigator.geolocation) {
      navigator.geolocation.watchPosition(function(position) {
        var latitude = position.coords.latitude;
        var longitude = position.coords.longitude;
        if (has_loaded == false) {
          $.ajax({
            type: 'GET',
            url: '/user_location',
            dataType: 'JSONP',
            data: { coordinates: {lat: latitude, lon: longitude}}
          });
          has_loaded = true;
        }
      }, function (error) {
        if (error.code == error.PERMISSION_DENIED) {
          var locations = document.getElementById("locations_list");
          if (locations) {
            var location_error = document.createElement('div');
            location_error.innerHTML = "Geo location services appear to be disabled on your device.";
            location_error.id = "location_permissions_error";
            locations.appendChild(location_error);
          }
        }
      });
    }
  };

